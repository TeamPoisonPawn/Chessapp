<script>
$(document).ready(function () {

  // Selecting & Moving Pieces
  $('.chess-board a').draggable({containment: "chess-board", revert: 'invalid'});

  $('.chess-board td').droppable({
    drop: function(event, ui) {
      var dropped = ui.draggable;
      var droppedOn = $(this);
      $(droppedOn).droppable("disable");
      $(dropped).parent().droppable("enable");
      $(dropped).detach().css({top: 0, left: 0}).appendTo(droppedOn);
      helper: 'clone'
      var update_piece = {
          id: $(dropped).attr('piece_id'),
          x_pos: $(droppedOn).attr('tile_x'),
          y_pos: $(droppedOn).attr('tile_y'),
        };
       $.ajax({
        type: 'PATCH',
        method: 'POST',
        url: '/pieces/' + update_piece.id,
        dataType: 'json',
        data: {id: update_piece.id, x_pos: update_piece.x_pos, y_pos: update_piece.y_pos},
        done: function(data) {
          if (!data.success){
            alert("Invalid Move");
          }
        }
      });
    }
  });
});   

// $('td').not('td:empty').droppable("disable");
</script>

<%= render 'shared/gameboard', pieces: @game.pieces, selected_piece: nil %>