<script type="text/javascript">
$( function() {
  $('a').draggable({ containment: "chess-board", revert: 'invalid' });

  $('td').droppable({
      drop: function(event, ui) {
          var dropped = ui.draggable;
          var droppedOn = $(this);
          $(droppedOn).droppable("disable");
          $(dropped).parent().droppable("enable");
          $(dropped).detach().css({top: 0, left: 0}).appendTo(droppedOn);
      }
    });
});   

$('td').not('td:empty').droppable("disable");
</script>

<br />

<div class="booyah-box col-xs-10 col-xs-offset-1">
  <h1 class="text-center">The Battleground</h1>
  <center>
    <div class="board-container">
      <table class="chess-board">
        <tbody>
          <% 7.downto(0) do |row| %>
            <tr>
              <% 0.upto(7) do |col| %>
                <td class="<%= white_or_black(row) %>"><a>
                  <% if selected_piece %>
                    <%= link_to '', piece_path(id: selected_piece.id, x_pos: col, y_pos: row), :class => piece_link(selected_piece), method: :put %>
                  <% end %>

                  <% pieces.detect do |piece| %>
                    <% if piece.x_pos == col && piece.y_pos == row && piece.active %>
                      <%= link_to image_tag("#{piece.piece_type}.jpg"), piece_path(piece.id), :class => hilight(piece) %>
                    <% end %>
                  <% end %>
              <% end %>
            </tr>
          <% end %>
        </a></tbody>
      </table>
    </div>
  </center>
</div>
